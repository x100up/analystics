{#
 taskItem
#}
<h3 title="{{ data.description or 'Нет описания' }}" class="{{ x }}">{{ data.name or name }}</h3>
<input type="hidden" name="tag_{{ taskItem.index }}_name" value="{{ name }}">

    <div class="tag_values_block {% if data.type == 'choose' and not data['values'].items and data['values']|length > 5 %} more_value{% endif %}">

    {% if data['extra'] %}
        {% set extra = data['extra'] %}
    {% else %}
        {% set extra = [] %}
    {% endif %}

    {% if data.type == 'choose' %}

        {% if data['values'].items %}
            <ul>
            {% for v, k in data['values'].items() %}
                <li><input type="checkbox" value="{{ v }}" name="tag_{{ taskItem.index }}_{{ name }}"
                    {% if value and v in value %} checked="checked" {% endif %}> : {{ k or v }}
                </li>
            {% endfor %}
            </ul>

        {% else %}

            {% if data['values']|length < 6   %}
                {% for v in data['values'] %}
                    {{ v }}: <input type="checkbox" value="{{ v }}" name="tag_{{ taskItem.index }}_{{ name }}"
                        {% if value and v in value %} checked="checked" {% endif %}>
                {% endfor %}
            {% else %}
                {% for v in data['values'] %}
                    <ul>
                        <li><input type="checkbox" value="{{ v }}" name="tag_{{ taskItem.index }}_{{ name }}"
                                {% if value and v in value %} checked="checked" {% endif %} > {{ v }}</li>
                    </ul>
                {% endfor %}
            {% endif %}
        {% endif %}

    {% elif data.type == 'boolean' %}
        Да: <input type="radio" name="tag_{{ taskItem.index }}_{{ name }}" id="tag_{{ taskItem.index }}_{{ name }}_1" value="1"
                {% if value == '1' %}checked="checked" class="checked" {% endif %} onclick="resetRadio(this)">
        Нет: <input type="radio" name="tag_{{ taskItem.index }}_{{ name }}" id="tag_{{ taskItem.index }}_{{ name }}_0" value="0"
                {% if value == '2' %}checked="checked" class="checked" {% endif %} onclick="resetRadio(this)">
    {% elif data.type == 'int' %}
       <input type="text" name="tag_{{ taskItem.index }}_{{ name }}" value="{{ value or '' }}">
    {% else %}
       {# default string type #}
        {% if value %}

            {% for val in value %}
                <input type="text" name="tag_{{ taskItem.index }}_{{ name }}" value="{{ val or '' }}" data-index="{{ loop.index0 }}"
                       onkeydown="tagValueChange('string', this, '{{ name }}', {{ taskItem.index }})"
                       class="tag_{{ name }} i_{{ loop.index0 }}">
            {% endfor %}
        {% else %}
            <input type="text" name="tag_{{ taskItem.index }}_{{ name }}" value="" data-index="0" class="tag_{{ name }} i_0"
                   onkeydown="tagValueChange('string', this, '{{ name }}', {{ taskItem.index }})">
        {% endif %}
       <input type="text" name="tag_{{ taskItem.index }}_{{ name }}" id="{{ name }}_value_cloner_{{ taskItem.index }}"
        onclick="addTextField({{ taskItem.index }}, '{{ name }}')" class="new tag_{{ name }}"
        onkeydown="tagValueChange('string', this, '{{ name }}', {{ taskItem.index }})">
    {% endif %}
    </div>

    <div class="op_controll">
        {#
        <span class="sync sync_{{ name }}" onclick="switchTagSync({{ taskItem.index }}, '{{ name }}', this)">sync</span>
         #}
        {% set operations = taskItem.getTagOperations(name)  %}
        {# operation stacks #}
        <input type="hidden" name="tag_{{ taskItem.index }}_{{ name }}_ops" id="tag_{{ taskItem.index }}_{{ name }}_ops" value="{{ operations|join('/') }}">
        <span class="group{% if 'group' in operations %} selected{% endif %}" onclick="switchKeyOp({{ taskItem.index }}, '{{ name }}', 'group', this)">group</span>
        {% if data.type == 'int' %}
        <span class="sum{% if 'sum' in operations %} selected{% endif %}" id="sum_{{ taskItem.index }}_{{ name }}" onclick="switchKeyOp({{ taskItem.index }}, '{{ name }}', 'sum', this)">sum</span>
        <span class="avg{% if 'avg' in operations %} selected{% endif %}" id="avg_{{ taskItem.index }}_{{ name }}" onclick="switchKeyOp({{ taskItem.index }}, '{{ name }}', 'avg', this)">avg</span>
        {% endif %}
    </div>
