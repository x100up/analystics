{#
 index
 tag_name
 values
#}
<div id="tag_{{ index }}">
    <h3 class="tag_{{ index }}_h">Тег: {{ tag_name }}</h3>
<div class="grid_6 alpha">
    <input type="hidden" name="tag_index" value="{{ index }}">

    <ul>
        <li>
            <label>Код</label>
            <input type="text" name="tag_{{ index }}_code" id="tag_{{ index }}_code" value="{{ tag_name }}">
        </li>
        <li>
            <label for="tag_{{ index }}_name">Название:</label>
            <input type="text" name="tag_{{ index }}_name" id="tag_{{ index }}_name" value="{{ values.name or "" }}">
        </li>
        <li>
            <label for="tag_{{ index }}_type">Тип: </label>
            <select name="tag_{{ index }}_type" id="tag_{{ tag }}_type" onchange="onChangeType(this, {{ index }})">
                <option value="string" {% if values.type == 'string' %}selected="selected"{% endif %}>Строка</option>
                <option value="int" {% if values.type == 'int' %}selected="selected"{% endif %}>Целое (int)</option>
                <option value="choose" {% if values.type == 'choose' %}selected="selected"{% endif %}>Выбор</option>
                <option value="boolean" {% if values.type == 'boolean' %}selected="selected"{% endif %}>Логический (bool)</option>
            </select>
        </li>
    </ul>

    <div class="grid_6 choose alpha omega" id="tag_choose_{{ index }}" {% if values.type != 'choose' %} style="display: none" {% endif %}>
        {% if not values.has_key('values') %}
            {% set tag_values = [] %}
        {% else %}
            {% set tag_values = values['values'] %}
        {% endif %}

        <table>
            <thead>
            <tr>
                <th>Варианты</th>
                <th>Описание</th>
            </tr>
            </thead>

            <tbody>
            {% set new_index = 0 %}
            {% if values.type == 'choose' %}
                {% set isDict = False %}
                {% if tag_values.items %}
                    {% set isDict = True %}
                {% endif %}
                {% set new_index = tag_values|length %}
                {% for key in tag_values %}
                    <tr>
                        <td><input type="text" name="tag_{{ index }}_values_key_{{ loop.index0 }}" value="{{ key }}" class="tag_{{ index }}_values_key"> :</td>
                        <td><input type="text" name="tag_{{ index }}_values_value_{{ loop.index0 }}" value="{% if isDict %}{{ tag_values[key] or ''}} {% endif %}"></td>
                    </tr>

                {% endfor %}
            {% endif %}
            <tr class="new">
                <td><input type="text" onkeypress="setNew({{ index }})" name="tag_{{ index }}_values_key_{{ new_index }}"
                    class="new_tag_value_{{ index }}"></td>
                <td><input type="text" onkeypress="setNew({{ index }})" name="tag_{{ index }}_values_value_{{ new_index }}"
                    class="new_tag_value_{{ index }}"></td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="tag_{{ index }}_values_count" id="tag_{{ index }}_values_count" value="{{ new_index }}">
    </div>
</div>
    <div class="grid_6 omega" id="tag_distinct_{{ index }}">
        <span class="awesome red" onclick="showTagValues({{ index }})">Посмотреть варианты</span>
    </div>
    <div class="clearfix"></div>
</div>